<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:func="http://aps.com/functions"
	xmlns:r="http://richfaces.org"
	xmlns:of="http://omnifaces.org/functions"
	template="/WEB-INF/templates/default.xhtml">
	<f:metadata>
        <f:viewParam name="id" value="#{incidentViewBacking.id}" />
    </f:metadata>
	<ui:define name="content">			
		<div class="well planview">
			<h:panelGroup rendered="#{incidentViewBacking.incident == null}">
				<h1>
					#{msg.incident_view_no_incident}
				</h1>
			</h:panelGroup>
			<h:panelGroup rendered="#{incidentViewBacking.incident != null}">
				<h1>
					#{incidentViewBacking.incident.title}
				</h1>	
				<h2>
					#{incidentViewBacking.incident.description}
				</h2>
				<h3>
					<span id="timestamp">
						#{msg.incident_view_lastpublished} 
						<h:outputText value="#{incidentViewBacking.incident.lastPublished}" converter="dateTimeConverter">
							<f:attribute name="pattern" value="HH:mm"/>
						</h:outputText>			
						<h:outputText value=" - "/>
						#{msg.incident_view_nextreview} 
						<h:outputText value="#{incidentViewBacking.incident.nextReview}" converter="dateTimeConverter">
							<f:attribute name="pattern" value="HH:mm"/>
						</h:outputText>
					</span>
				</h3>
				<br/>
				<div class="row clearfix">					
					<ul>
						<ui:repeat var="serviceGroupAlteration" value="#{incidentViewBacking.incident.serviceGroupAlterations}">
							<li>
								#{func:format(serviceGroupAlteration)}																		
								<h:panelGroup rendered="#{not empty serviceGroupAlteration.freeform}" >
									<br/>
									#{serviceGroupAlteration.freeform}																			
								</h:panelGroup>
							</li>							
						</ui:repeat>
					</ul>					
				</div>
			</h:panelGroup>
		</div>	
		
		<h:outputScript target="body">			
			jQuery(function() {
				setTimeout(function() {location.reload(true);}, 60000);		// 1 minute		    		
			});
		</h:outputScript>
		
	</ui:define>
	<ui:define name="footer">
		#{msg.incident_view_lastupdated} 
		#{of:formatDateWithTimezone(now, 'HH:mm:ss', dateTimeZone.ID)}		
	</ui:define>
</ui:composition>
